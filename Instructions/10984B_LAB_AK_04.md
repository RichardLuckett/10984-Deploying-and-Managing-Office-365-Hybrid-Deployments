# Lab Answer Key:  Module 4: Exchange Server hybrid deployment
# Lab: Implement the Exchange Server hybrid deployment
  
## Exercise 1: Using the Hybrid Configuration Wizard
  
#### Task 1: Verify public accessibility
  

1. On **LON-WAP1**, already signed in as **LON-WAP1\Administrator**, open Internet Explorer, navigate to **bing.com**, type **whatismyipaddress.com** in the **Search** box, and then press Enter.
2. If an Internet Explorer dialog box open, Click **Yes**.
3. Confirm this is the same Public IP address you have used in prior labs. Document the public IP address displayed for the **LON-WAP1** server. You will need this IP address later.
4. Close the **Internet Explorer** window.
5. On **LON-CL1**, sign in as **Adatum\Beth** with the password **Pa55w.rd**, from the taskbar, open Microsoft Edge, and then navigate to [https://aka.ms/AA2p30o](https://aka.ms/AA2p30o).

    >**Note:** if you are signed in as a different user from a previous lab, first sign out, select the option to sign in as **Other user** and then sign in as **Adatum\Beth**.

6. In the **Microsoft Remote Connectivity Analyzer** window, select the **Exchange server** tab, and then in the **Microsoft Exchange Web Services Connectivity Tests** section, select **Synchronization, Notification, Availability, and Automatic Replies**. Select **Next**.
7. In the **Synchronization, Notification, Availability, and Automatic Replies** window, specify the following:

  - Email address: **abbi@Adatumyyxxxxx.hostdomain.com**
  - Domain\User Name (or UPN): **abbi@Adatumyyxxxxx.hostdomain.com**
  - Password: **Moc10984B**
  - Confirm Password: **Moc10984B**
  - Select the **I understand that I must use the credentials of a working account from my Exchange domain to be able to test connectivity to it remotely. I also acknowledge that I am responsible for the management and security of this account** check box.

    >**Note:** If you receive the error **"Verifying the challenge failed. Please refresh the page and try again."** in the next step, this means the captcha feature is not currently working. This is a know issue that happens periodically with this site. If the issue does not resolve within 5 minutes you should skip to step 20 and continue with the lab. 

8. Type the verification characters, select **Verify**, and then select **Perform Test**.

    > **Note:** You should receive a "Connectivity Test Successful with Warnings" message. This indicates that on-premises Exchange Web Services is accessible. If you do receive an error, verify that DNS records were created on LON-DC1 using your assigned custom domain name.

9. Select **Start Over** to go back to the **Exchange Server** tab.
10. In the **Microsoft Office Outlook Connectivity Tests** section, select **Outlook Autodiscover**, and then select **Next**.
11. In the **Outlook Autodiscover** window, specify the following:

  - Email address: **abbi@Adatumyyxxxxx.hostdomain.com**
  - Domain\User Name (or UPN): **abbi@Adatumyyxxxxx.hostdomain.com**
  - Password: **Moc10984B**
  - Confirm Password: **Moc10984B**
  - Select the **I understand that I must use the credentials of a working account from my Exchange domain to be able to test connectivity to it remotely. I also acknowledge that I am responsible for the management and security of this account** check box.

12. If necessary, type the verification characters, select **Verify**, and then select **Perform Test**.
13. In the **Test Details** section, select **Expand All**, locate the **Attempting to resolve the host name adatumyyxxxxx.hostdomain.com in DNS** test step, and then compare the IP addresses returned in this test step to the one you documented in step 2. If it matches one of the addresses, you have connected to your on-premises server by using Outlook Anywhere.

    > **Note:** You should receive a "Connectivity Test Successful with Warnings" message. Selecting the **Ignore Trust for SSL** check box would allow this test to succeed even if your certificate is not trusted.

14. To return to the **Exchange Server** tab, select **Start Over**.
15. In the **Internet E-Mail Tests** section, select **Inbound SMTP E-Mail**, and then select **Next**.
16. In the **Inbound SMTP E-Mail** window, type the following email address: **abbi@adatumyyxxxxx.hostdomain.com**.
17. If necessary, type the verification characters, and then select **Verify**. Select **Perform Test**.

    > **Note:** You should receive a "Connectivity Test Successful" message.

    > Simple Mail Transfer Protocol (SMTP) uses opportunistic Transport Layer Security (TLS) by default. Even if the Microsoft Remote Connectivity Analyzer does not trust the certificate, the test message will succeed.

18. In the **Test Details** window, select **Expand All**, scroll to the last test performed, and then verify that the following message appears: "The Open Relay test passed. This MX isn't an open relay." 
19. Exit the Remote Connectivity Analyzer by closing Microsoft Edge.
20. On **LON-EX1**, already signed in as **Adatum\Administrator**, click **Start** and expand Microsoft Exchange Server 2019 and select Exchange Management Shell.
21. In the **Exchange Management Shell** window, run the following command, and then press Enter:

    ```
    Get-ExchangeCertificate | Where-Object {$_.Subject -match "^CN=\*"} | Format-List
    ```

22. In the **Exchange Management Shell** window, confirm the certificate that on-premises Microsoft Exchange Server uses by reviewing the results for the following attributes:

  - IsSelfSigned: **False**
  - NotAfter: _date not expired_
  - Status: **Valid**
  - Services: **SMTP**

    > **Note:** It is a good idea to document the thumbprint for the certificate that Exchange Server used. Event logs typically reference a certificate thumbprint, rather than the subject or friendly name, in warnings and error messages. This is also helpful when multiple certificates with the same subject name exist.
    > In your production environments, you also want to make sure that **Issuer** is trusted third party public certificate authority so Microsoft Exchange Online can trust the certificate.

23. Leave the **Exchange Management Shell** window open.


#### Task 2: Use the Exchange admin center to verify on-premises deployment
  

1. On **LON-CL1**, already signed in as **Adatum\Beth**, open Microsoft Edge, and then navigate to **https://portal.office.com/AdminPortal/Home**. Sign in as **beth@adatumyyxxxx.onmicrosoft.com** with the password you created in the lab in Module 1, "Introduction to Office 365 administration and licensing. "
2. On **LON-EX1**, already signed in as **Adatum\Administrator**, open the Exchange admin center. To do this, open Internet Explorer, and then navigate to **https://lon-ex1.adatum.com/ecp**. Sign in as **Adatum\Administrator** with the password **Pa55w.rd**.
3. In the navigation pane on the left side, select **Permissions**.
4. In the **admin roles** list, double-click **Organization Management**.
5. On the **Organization Management** page, scroll down to the **Members** section. Confirm that **Administrator**, the account you are signed in with, is a member.
6. To return to the **admin roles** list, select **Cancel**.
7. Double-click the **Compliance Management** admin role.
 
    > **Note:** By default, this group has no members. If your production environment lists any administrators, document them so you can grant them the equivalent role in Exchange Online.

8. To return to admin roles list, click **Cancel**.
9. In the navigation pane on the left side, select **organization**.
10. On the **sharing** tab, review the default settings. Note that no organization relationship is set up. When you run the **Hybrid Configuration Wizard**, it creates an organization relationship so that individual users do not have to manage sharing free/busy information with other users cross-premises.
11. On the navigation menu on the left side, select **mail flow**.
12. On the **mail flow** page, select the **accepted domains** tab. Note the **Accepted Domain** and **Domain type** fields for each domain in the list.
13. On the **mail flow** page, select the **receive connectors** tab. Note that five Receive connectors exist:

  - **Client Frontend LON-EX1 - FrontendTransport**
  - **Default frontend LON-EX1 - FrontendTransport**
  - **Outbound Proxy Frontend LON-EX1 - Frontend Transport**
  - **Client Proxy LON-EX1 - HubTransport**
  - **Default LON-EX1 -HubTransport**

14. On the **mail flow** page, select the **send connectors** tab. Note that one connector exists. However, no Send connectors exist by default when Exchange Server is deployed.

    > **Note:** By running the **Hybrid Configuration Wizard**, you will create specific connectors in Exchange Online and on-premises for the hybrid environment.

15. On the navigation menu on the left side, notice there is no **unified messaging** option. Exchange Server 2019 and newer no longer include this service.
16. In the navigation pane on the left side, select **servers**. Document the version of the on-premises server.
17. In Internet Explorer, open a new tab, navigate to [https://aka.ms/AA216yr](https://aka.ms/AA216yr), and then locate the product and cumulative update or rollup that matches the build number displayed in the Exchange admin center.

    > **Note:** Remember that the version of Exchange Server you are running impacts the version of the **Hybrid Configuration Wizard** you can use and the features that your hybrid deployment makes available.

18. Switch to the **servers - Microsoft Exchange** tab.
19. In the navigation pane on the left side, select **hybrid**. Note that you can access the **Hybrid Configuration Wizard** web app here in Exchange Server on-premises. The same option is available in Microsoft Office 365.
20. Leave Internet Explorer open. You will need the Exchange admin center for the following task.


#### Task 3: Run the Hybrid Configuration Wizard
  

1. On **LON-EX1**, already signed in as **Adatum\Administrator**, note the Exchange admin center still open from the previous task. If it isn't, open Internet Explorer, and then navigate to **https://lon-ex1.adatum.com/ecp**.
2. In the navigation pane on the left side, select **hybrid**. Clear the **My Office 365 organization is hosted by 21Vianet** check box, and then select **configure**.
3. In the **information** dialog box, select **sign in to Office 365**.
4. In the **Sign in** dialog box, type **beth@adatumyyxxxx.onmicrosoft.com**, select **Next**, type the password that you created in the lab in Module 1, "Introduction to Office 365 administration and licensing," and then select **Sign in**.

     > **Note:** If Stay signed in? page appears click **No**.


5. On the **Enterprise** tab, in the navigation pane on the left side, select **hybrid**, and then select **configure**.

    > **Note:** If you receive an error "application is improperly formatted", add the **https://mshrcstorageprod.blob.core.windows.net** website as a trusted site in the Internet Explorer security settings.

6. In the **Application Install - Security Warning** window, select **Install**. If the **Do you want to run this file** dialog box appears, select **Run**.
7. On the **Hybrid Configuration Wizard** page, select **next**.
8. On the **On-premises Exchange Server Organization** page, verify that **Detect the optimal Exchange server** is selected and that **LON-EX1** is detected. Verify that **Office 365 Worldwide** is selected for **Office 365 Exchange Online**, and then select **next**.
9. On the **On-premises Exchange Account** page, confirm that **Adatum\Administrator** is selected. If it is not, select **enter** and enter the credentials.
10. Under the **Office 365 Exchange Online account** section, select **sign in**, sign in as **beth@adatumyyxxxx.onmicrosoft.com** with the password you created in lab in Module 1, "Introduction to Office 365 administration and licensing," and then select **next**.
11. On the **Gathering Configuration Information** page, wait for the process to complete, and then select **next**.
12. On the **Hybrid Features** page, select **Full Hybrid Configuration**, select **Organization Configuration Transfer**, and then select **next**.
13. On the **Federation Trust** page, select **enable**.
14. On the **Domain Ownership** page, select **Copy to notepad**.
15. When Notepad opens, select **File**, select **Save as**, select the **C:\Labfiles\Mod04** folder, type **TXTProof.txt** in the **File name** box, and then select **Save**.
16. On **LON-DC1**, open File Explorer, and then in the **path** field, type **\\\LON-EX1\C$\Labfiles\Mod04**. To access the domain proof, double-click **TXTproof.txt**.
17. In the **Space Separated** section, select and copy the string value. Do not include the custom domain name.
18. From the taskbar, open the **DNS Manager** tool. If DNS Manager is not on the task bar open Server Manager, select Tools and then select DNS.
19. To add a TXT record, expand the **LON-DC1** node, expand **Forward Lookup Zones**, select the custom domain zone (for example, **adatumyyxxxxx.hostdomain.com**), right-click the zone, select **Other New Records**, select **Text (TXT)** in the list, and then select **Create Record**.
20. In **New Resource Record** window, in the **Text** section, paste the text proof string. It should have no leading spaces and end with two equal signs (==). select **OK** to create the record. select **Done** to close the **Resource Record type** window.
21. On **LON-EX1**, return to the **Domain Ownership** page, select the **I have created a TXT record for each token in DNS** check box, and then select **verify domain ownership**.
22. On the **Hybrid Topology** page, verify that **Use Exchange Classic Hybrid Topology** is selected and then click **Next**.
23. If the On-premises Account for Migration page appears, select **enter**, in the Office 365 dialog box type **Adatum\Administrator** with the password **Pa55w.rd**, select **ok** and then select **next**.
24. On the **Hybrid Configuration** page, leave the **Configure my Client Access and Mailbox servers for secure mail transport (typical)** default option selected, and then select **next**.
25. On the **Receive Connector Configuration** page, select the drop-down box arrow, select the **LON-EX1** check box, and then select **next**.
26. On the **Send Connector Configuration** page, select the drop-down box arrow, select the **LON-EX1** check box, and then select **next**.
27. On the **Transport Certificate** page, select the drop-down box arrow, select the wildcard certificate for **\*.hostdomain.com**, and then select **next**.
28. On the **Organization FQDN** page, type **adatumyyxxxxx.hostdomain.com**, and then select **next**.
29. On the **Organization Configuration Transfer** page select **Review the objects before transferring from on-premises to exchange online** and select **next**.
30. On the **Organization Configuration Transfer - Review Objects** page, select the check box for **Remote Domains** and **Organization Config**, and then select **next**.
31. On the **Ready for Update** page, select **update**.

    >**Note:** If you select the Objects checkbox, you can safely ignore the **HCW8110** errors. These errors are generated in the logs when a policy that is being transfered already exists.

32. Wait for the **Hybrid Configuration Wizard** to complete. On the **Congratulations** page select **close**.


#### Task 4: Review the changes that the Hybrid Configuration Wizard made (Optional)

1. On **LON-EX1**, already signed in as **Adatum\Administrator**, open the Exchange admin center. If prompted, sign in as **Adatum\Administrator** with the password **Pa55w.rd**.
2. To verify that you are viewing the on-premises environment, select **Enterprise** in the **Exchange admin center** window.
3. On the navigation menu on the left side, select **organization**.
4. On the **sharing** tab, review the settings. Note the two new sections: **Organization Sharing** and **Individual Sharing**.
5. Under **Organization Sharing**, select the **On-premises to O365** policy, select **Edit** (the pencil icon), review the **general** and **sharing** settings, and then select **cancel**. Note that under **Domains**, the domain name is the online domain name.
6. Under **Individual Sharing**, select the **Default Sharing Policy (DEFAULT)** policy, and then select **Edit**. Review the sharing policy settings, and then select **cancel**.
7. On the navigation menu on the left side, select **mail flow**.
8. On the **mail flow** page, select the **accepted domains** tab. Note that the new accepted domain that the **Hybrid Configuration Wizard** added is **Adatumyyxxxxx.mail.onmicrosoft.com**.
9. On the **mail flow** page, select the **send connectors** tab. Note the new connector: **Outbound to Office 365**.
10. Double-click **Outbound to Office 365**, select **scoping**, and then under **Address space**, confirm that the only domain listed is **adatumyyxxxxx.mail.onmicrosoft.com**. Note that this matches the new accepted domain.
11. To close the **Outbound to Office 365** window, select **cancel**.
12. To verify that you are viewing the online environment, select **Office 365** in the **Exchange admin center** window.

    > **Note:** When you select the **Office 365** tab, you might be prompted to sign in to Office 365. If so, sign in as **beth@adatumyyxxxx.onmicrosoft.com** with the password you created in the lab in Module 1, "Introduction to Office 365 administration and licensing."

13. On the navigation menu on the left side, select **organization**.
14. On the **sharing** tab, review the settings. Note that the same two sections now exist online: **Organization Sharing** and **Individual Sharing**.
15. Under **Organization Sharing**, select the **O365 to On-Premises** policy, select **Edit** (the pencil icon), review the **general** and**sharing** settings, and then select **cancel**. Note that under **Domains**, the domain listed is the on-premises domain name.
16. Under **Individual Sharing**, select the **Default Sharing Policy (DEFAULT)** policy, and then select **Edit**. Review the sharing policy settings, and then select **cancel**. Note that the online policy is configured with the same settings as the on-premises default sharing policy.
17. On the navigation menu on the left side, select **mail flow**.
18. On the **mail flow** page, select the **accepted domains** tab. Note that the new accepted domain that the **Hybrid Configuration Wizard** added is **Adatumyyxxxxx.mail.onmicrosoft.com**.
19. On the **mail flow** page, select the **connectors** tab. Note the new Inbound and Outbound connectors that the **Hybrid Configuration Wizard** created.
20. To review the settings of the Inbound connector, select the name that starts with **Inboundfrom**, and then view the details pane.
21. To review the settings of the Outbound connector, select the name that starts with **Outbound to**, and then view the details pane.
22. Leave the Exchange admin center open. You will need it for the next exercise.
23. On the taskbar, select the **Exchange Management Shell** icon.
24. In the Exchange Management Shell, type the following command, and then press Enter:

    ```
    Get-HybridConfiguration
    ```

25. Review the results, and then close the **Exchange Management Shell** window.

> **Result**: After completing this exercise, you should have verified the on-premises deployment and run the Hybrid Configuration Wizard.


## Exercise 2: Move mailboxes between Exchange on-premises and Exchange Online
  
#### Task 1: Move mailboxes to Exchange Online

1. On **LON-EX1**, already signed in as **Adatum\Administrator**, open the Exchange admin center. If prompted, sign in as **Adatum\Administrator** with the password **Pa55w.rd**.
2. Open the Exchange Management Shell, and then type the following commands, pressing Enter after each command:

    ```
    Set-Mailbox "adam" -EmailAddresses @{remove="adam@adatum.com"}
    ```

    ```
    Set-Mailbox "abbi" -EmailAddresses @{remove="abbi@adatum.com"}
    ```

    ```
    Set-Mailbox "allan" -EmailAddresses @{remove="allan@adatum.com"}
    ```

    ```
    Set-Mailbox "cai" -EmailAddresses @{remove="cai@adatum.com"}
    ```

    ```
    Set-Mailbox "ella" -EmailAddresses @{remove="ella@adatum.com"}
    ```

    ```
    Set-Mailbox "jon" -EmailAddresses @{remove="jon@adatum.com"}
    ```

3. On **LON-DS1**, already signed in as **Adatum\Administrator**, select **Start**, expand **Azure AD Connect**, and then select **Synchronization Service**.
4. In the **Synchronization Service Manager on LON-DS1** window, select the **Connectors** tab, double-click **Adatum.com**, select **Configure Directory Partitions**, and then select **Containers**.
5. In the **Credentials** dialog box, type **Administrator** in the **User** **name** box, type **Pa55w.rd** in the **password** box, and then select **OK**.
6. In the **Select Containers** window, confirm that **IT** and **Research** are selected, select the following check boxes, and then select **OK**:

  - **Development**
  - **Managers**
  - **Marketing**
  - **Sales**

7. To close the **Properties** window, select **OK** and when the warning window appears click **OK**.
8. Click **Start**, select **Windows PowerShell**, type the following command, and then press Enter:

    ```
    Start-ADSyncSyncCycle -PolicyType Initial
    ```

9. Switch back to the **Synchronization Service Manager on LON-DS1** window, select the **Operations** tab, and then review the six connector operations (**Full Import**, **Full Import**, **Full Synchronization**, **Full Synchronization**, **Export**, and **Export**).
10. Close the **Synchronization Service Manager on LON-DS1** window.

    > **Note:** Expect around 200 new **Adds** (users and groups) to synchronize from **Adatum.com** to your Office 365 tenant. You might receive one or two export errors that you can ignore.

    > Synchronizing user accounts before they are migrated is an important prerequisite to moving a mailbox. If you don't do this, you might end up with duplicate accounts for your users.

11. On **LON-EX1**, already signed in as **Adatum\Administrator**, open the Exchange admin center. If prompted, sign in as **Adatum\Administrator** with the password **Pa55w.rd**.
12. To verify that you are viewing the online environment, select **Office 365** in the **Exchange admin center** window. If prompted, sign in as **beth@adatumyyxxxx.onmicrosoft.com** with the password you created in the lab in Module 1, "Introduction to Office 365 administration and licensing."
13. In the **Exchange admin center** window, select **recipients**, select **Migration**, select **More** (the ellipsis icon), and then select **Migration endpoints**.
14. On the **Migration Endpoints** page, verify that the **Hybrid Migration Endpoint -EWS (Default Web Site)** was created, and then click **Close**.

    > **Note:** You use Outlook Anywhere only in a cutover or staged migration and not a hybrid migration.

    > The **Hybrid Configuration Wizard** automatically creates a hybrid migration endpoint to **adatumyyxxxxx.hostdomain.com**.

15. Select **New** (the plus icon), and then select **Migrate to Exchange Online**.
16. On the **Select a migration type** page, select **Remote move migration (supported by Exchange Server 2010 and later versions)**, and then select **Next**.
17. On the **Select the users** page, select **Add** (the plus icon), and then on the **Select Mail User** page, double-click **Adam Hobbs**, **Abbi Skinner**, **Allan Yoo**, **Cai Chu**, **Ella Perry**, and **Jon Friday**, and then select **OK**.
18. On the **Select the users** page, select **Next**.
19. On the **Confirm the migration endpoint** page, you will find **adatumyyxxxx.hostdomain.com** under Remote MRS proxy server box, and then click **Next**.
20. On the **Move configuration** page, enter the following information, and then select **Next**:

  - New migration batch name: **First Batch**
  - Target delivery domain: **adatumyyxxxx.mail.onmicrosoft.com**
  - Archive: **Move the primary mailbox and the archive mailbox if one exists**
  - Bad item limit: **10**
  - Large item limit: null

21. On the **Start the batch** page, under the **Please select the preferred option to complete the batch** section, select **Automatically complete the migration batch**. Leave all other settings at their default values, and then select **new**.
22. On the **migration** page, monitor the status of **First Batch**. Periodically use the **Refresh** button until the status changes to **Completed**. The expected results are **Finalized 6** and **Failed 0**.

    > **Note:** This process can take up to 30 minutes to complete. Skip to Exercise 3, and return to complete this exercise later.

23. On the **migration** page, select **First Batch**, select **Delete** (the trash can icon), and then on the **Warning** page, select **Yes**.
24. In Internet Explorer, open a new tab, and then navigate to **https://portal.office.com/adminportal/home**. If prompted to sign in, sign in as **beth@adatumyyxxxxx.hostdomain.com** with the password you created in the lab in Module 1, "Introduction to Office 365 administration and licensing."
25. Select **Users**, select **Active users**, and then select the check boxes for **Abbi Skinner**, **Adam Hobbs**, **Allan Yoo**, **Cai Chu**, **Ella Perry**, and **Jon Friday**.

    >**Note:** Not all users will appear in the same screen and you may not be able to scroll down the list with your mouse. If this happens, you can use the up and down arrows on the keyboard to scroll and the space bar to select users. Alternatively, you can assign licenses to the users individually or in smaller batches. It is important that all users listed are assigned a license in order for the users to access their migrated mailboxes. 

    >**Note:** Not licensing these users now will create long delays in later labs.

26. On the menu bar select **Manage product licenses**, on the **Manage product licenses** page, select **Add to existing product license assignments**, and then select **Next**.
27. On the **Add to existing products** page, in the box, select **United States**, move the slider to enable **Office 365 E5**, scroll down, and then select **Add**.
28. If you receive the note "We couldn't replace the products for everyone you selected" review the affected user and then click **Close**.


#### Task 2: Verify mailboxes functionality and mail flow (Optional)

1. On **LON-CL1**, sign out the current user (Adatum\Beth) by selecting **Start**, select **Beth Burke**, and then select **Sign out**.
2. On **LON-CL1**, sign in as **adam@adatumyyxxxxx.hostdomain.com** with the password **Pa55w.rd**.
3. To create a profile, select **Start**, type **Outlook**, and then in the search results, select **Outlook**. If the **Microsoft Office Activation Wizard** window appears click **Close**.
4. On **The fine print** page click **Accept and start Outlook**. On the **Welcome to Outlook** page, confirm Adam's email address **adam@adatumyyxxxxx.hostdomain.com** is specified and click **Connect**. 
5. When prompted to **Enter password** type **Pa55w.rd** and click **Sign in**.
6. On the **Use this account everywhere on your device** page, select **Yes**. On the **You're all set** page click **Done**.
7. On the **Account setup is complete** page, clear the check box for **Set up Outlook Mobile on my phone, too** and then click **OK**. If prompted, click **Connect** on the Microsoft Outlook dialog box.
8. In Outlook, click **OK** to close the **Meet Focused Inbox** dialog box, select **New Email**. In the **Untitled Message** window, type **holly** on the **To** line, type **Hybrid Test 1** on the **Subject** line, type **Online to on-premises** in the body of the message, and then select **Send**.
9. On the bottom navigation bar, select **Calendar**, and then on the ribbon, select **New Appointment**.
10. In the **Untitled - Appointment** window, on the **Subject** line, type **Hybrid Deployment**. Set the **Start time** to **today** at **4:30 pm** and the **End time** to **today** at **5:30 pm**.
11. Select **Save &amp; Close**.
12. On the bottom navigation bar, select **Mail**.
13. On **LON-CL2**, sign in as **holly@adatumyyxxxxx.hostdomain.com** with the password **Pa55w.rd**.
14. To create a profile, select **Start**, type **Outlook**, and then in the search results, select **Outlook**. If the **Microsoft Office Activation Wizard** window appears click **Close**.
15. On **The fine print** page click **Accept and start Outlook**. On the **Welcome to Outlook** page, confirm Holly's email address **holly@adatumyyxxxxx.hostdomain.com** is specified and click **Connect**. 
16. On the **Account setup is complete** page, clear the check box for **Set up Outlook Mobile on my phone, too** and then click **OK**. If prompted, click **Connect** on the Microsoft Outlook dialog box.
17. When prompted to **Enter password** type **Pa55w.rd** and click **Sign in**.
18. On the **Use this account everywhere on your device** page, select **Yes**. On the **You're all set** page click **Done**.
19. In **Outlook**, confirm that Holly received the email from Adam. This verifies that the hybrid connectors are working from online to on-premises.
20. In Outlook, select **New Email**. In the **Untitled Message** window, type **adam** on the **To** line, type **Hybrid Test 2** on the **Subject** line, type **On-premises to online** in the body of the message, and then select **Send**.
21. On the bottom navigation bar, select **Calendar**.
22. On the ribbon, select **New Meeting**.
23. In the **Untitled-Meeting** window, type **Adam Hobbs** on the **To** line, type **Hybrid Status Meeting** on the **Subject** line, and then type **Online** on the **Location** line.
24. Set **Start time** to **today** at **4:00 pm** and **End Time** to **today** at **5:00 pm**.
25. Select **Scheduling Assistant**. Note that Adam shows as busy from 4:30 to 5:30 PM today.
26. In the lower right, under **Suggested times**, scroll down, and then select **3:30 PM - 4:30 PM No conflicts**.
27. Select **Send**.

    > **Note:** The ability for Holly to see Adam's free/busy information verifies that the organizational relationship from online to on-premises is working for the hybrid configuration.

28. On **LON-CL1**, sign in as **adam@adatumyyxxxxx.hostdomain.com** with the password **Pa55w.rd**.
29. Open Outlook.

    > **Note:** If the **Microsoft Office Activation Wizard** appears, select **Close**.

30. In **Outlook**, confirm that Adam received the emails from Holly. This verifies that the hybrid connectors are working from on-premises to online.
31. Select **Hybrid Status Meeting**, select **Propose New Time**, and then select **Tentative and Propose New Time**. Note that Adam's free/busy information is visible.
32. Select **AutoPick Next&gt;**, select **Propose Time**, and then in the **New Time Proposed: Hybrid Status Meeting - Meeting Response** window, select **Send**. The expected result is a proposal for tomorrow from 8:00 AM through 9:00 AM.

    > **Note:** You have successfully verified the functionality and mail flow in a hybrid configuration. If you have already completed the Exercise 3 tasks, proceed to the "Prepare for the next module" task at the end of Exercise 3.

> **Result**: After completing this exercise, you should have moved mailboxes for onboarding to Exchange Online from your on-premises environment.


## Exercise 3: Configure message compliance and security in the hybrid environment
  
#### Task 1: Deploy the message archive in Exchange Online

1. On **LON-CL1**, open Edge, and then navigate to **https://portal.office.com/adminportal/home**. Sign in as **beth@adatumyyxxxx.onmicrosoft.com** with the password you created in the lab in Module 1, "Introduction to Office 365 administration and licensing."
2. In the navigation pane on the left side, select **Billing**, select **Purchase services**, and then scroll down to the **Other categories that might interest you** section. Select the **Collaboration and communication** link. Click on the **Exchange Online Archiving for Exchange Server** tile and then select **Get free Trial**.
3. On the **Check out** page, select **Try now**, and then on the **order receipt** page, select **Continue**.

    > **Note:** The Exchange Online Archiving for Exchange Server trial includes 25 licenses. You can use these for up to 30 days of testing.

4. In the navigation pane on the left side, select **Users**, select **Active users**, click on **Holly Spencer**, and then select **Licenses and Apps**.
5. Under **Location**, select **Untied States**.
6. Select the check box next to **Exchange Online Archiving for Exchange server** to assign the license to Holly.
7. Select **Save changes**, and then select **X** to close the **Holly Spencer's property** page.
8. On **LON-EX1**, open the Exchange admin center. If prompted, sign in as **Adatum\Administrator** with the password **Pa55w.rd**.
9. To verify that you are viewing the on-premises environment, select **Enterprise** in the **Exchange admin center** window.
10. In the navigation pane on the left side, select **Recipients**, select the **Mailboxes** tab, select **Holly Spencer**, and then in the details pane, under the **In-Place Archive** section, select **Enable**.
11. On the **create in-place archive** dialog box, select **Cloud-based archive: adatumyyxxxxx.mail.onmicrosoft.com**, and then select **OK**. Note that the **Mailbox type** changes to **User (Archive)**.

    > **Note:** It takes up to 30 minutes for the archive mailbox to provision for users in Exchange Online. For now, continue with the next task.

12. Leave the Exchange admin center open.


#### Task 2: Configure DLP
  

1. On **LON-EX1**, already signed in as **Adatum\Administrator**, open the Exchange admin center. If prompted, sign in as **Adatum\Administrator** with the password **Pa55w.rd**.
2. To verify that you are viewing the on-premises environment, select **Enterprise** in the Exchange admin center window.
3. In the **Exchange admin center** window, in the navigation pane on the left side, select **compliance management**.
4. Select the **data loss prevention** tab.
5. Next to **New**, select the arrow, and then select **New custom DLP policy**.
6. In the **new custom DLP policy** window, in the **Name** field, type **Restrict financial data flow**.
7. Select **Save**.
8. In the **Exchange admin center** window, select **Restrict financial data flow**, and then select **Edit**.
9. In the **edit DLP policy** window, on the **general** tab, select **Enforce**.
10. Select **rules**.
11. Next to **New**, select the arrow, and then select **Block messages with sensitive information unless the sender overrides**.
12. In the **new rule** window, select **Select sensitive information types**. In the **Contains any of these sensitive information types** window, select **Add**, and then in the **Sensitive Information types** list, select **Credit Card Number**. Select **add**, and then select **OK** twice.
13. In the **new rule** window, in the **Do the following** section, in the box, select **Block the message**, and then select **reject the message and include an explanation**.
14. In the **specify rejection reason** window, type **This message contains financial information and can't be sent outside the organization**, and then select **OK**.
15. On the right side of the **Generate incident report and send it to** box, select **Select one**.
16. In the **Select Members** window, select **Beth Burke**, and then select **OK**.
17. On the right side of the box, select **Custom content**.
18. In the **Include message properties** window, select **original mail**, **matching rules**, select **matching content**, and then select **OK**.
19. Scroll down, and then select **Activate this rule on the following date**. Next to the date field, select the arrow, and then select **today**.
20. In the **Choose a mode for this rule** list, select **Enforce**.
21. Select **Save**. If a warning window appears, select **OK**, and then select **Save** again.
22. Above the **Restrict financial data flow** policy, select **Customize Policy Tips** (on the toolbar, the fourth icon from the left side).
23. In the **Policy Tips** window, select **New**.
24. In the **New Policy Tip setting** window, under **Policy Tip**, select **Notify the sender**.
25. In the **Locale** box, select **English**.
26. In the **Text** box, type **This message contains information that you are not allowed to send**.
27. Select **Save**, and then select **Close**.

    > **Note:** In a hybrid configuration, you have to repeat cross-premises any changes you make to data loss prevention (DLP) policies. In this case, you created a new custom DLP policy on-premises. Additionally, you need to create this policy online to help protect the mailboxes that you move to Exchange Online.

28. Open the **Exchange Management Shell**.
29. To confirm that the DLP policy you just created is listed, type the following command, and then press Enter:

    ```
    Get-DlpPolicy
    ```

30. To export this policy, type the following command, and then press Enter:

    ```
    $file = Export-DlpPolicyCollection -Identity "Restrict financial data flow"; Set-Content -Path "C:\Labfiles\Mod04\EnterpriseDLP.xml" -Value $file.FileData -Encoding Byte
    ```

31.  Click **start** and **Windows PowerShell** (not the Exchange Management Shell), and then connect to Exchange Online. Sign in as **beth@adatumyyxxxx.onmicrosoft.com** with the password you created in the lab in Module 1, "Introduction to Office 365 administration and licensing," by running the following commands, pressing Enter after each one:

    ```
    $Creds = Get-Credential
    ```

    ```
    $Session = New-PSSession -ConfigurationName Microsoft.Exchange -ConnectionUri https://outlook.office365.com/powershell-liveid/ -Credential $Creds -Authentication Basic -AllowRedirection
    ```

    ```
    Import-PSSession $Session -AllowClobber
    ```

    > **Note:** You can safely disregard warnings about unapproved verbs.

32. To confirm that no DLP policies exist in Exchange Online, type the following command, and then press Enter:

    ```
     Get-DlpPolicy
    ```

33. To import the custom DLP policy into Exchange Online, type the following command, press Enter, type **Y** to confirm, and then press Enter again:

    ```
    Import-DlpPolicyCollection -FileData ([Byte[]]$(Get-Content -Path "C:\Labfiles\Mod04\EnterpriseDLP.xml" -Encoding Byte -ReadCount 0))
    ```

    >**Note:** You can safely ignore the warning regarding the Mode parameter.

34. To confirm that the policy was imported, type the following command, press Enter, and then review the results:

    ```
    Get-DlpPolicy | Format-List
    ```
35.  To disconnect your session, type the following command, and then press Enter:

    ```
    Remove-PSSession $Session
    ```

36. Close the Windows PowerShell window.


#### Task 3: Configure an In-Place Hold
  

1. On **LON-DC1**, open **Server Manager**, select **Tools**, and then select **Active Directory Users and Computers**.
2. In Active Directory Users and Computers, expand **Adatum.com**, and then select **Microsoft Exchange Security Groups**.
3. In the details pane on the right side, double-click **Discovery Management**.
4. In the **Discovery Management Properties** window, select the **Members** tab.
5. Select **Add**.
6. In the **Select Users, Contacts, Computers, Service Accounts, or Groups** window, type **Beth**, and then select **OK** twice.
7. In the details pane on the right side, double-click **Organization Management**.
8. In the **Organization Management Properties** window, select the **Members** tab.
9. Select **Add**.
10. In the **Select Users, Contacts, Computers, Service Accounts, or Groups** window, type **Beth**, and then select **OK** twice.
11. On **LON-EX1**, already signed in as **Adatum\Administrator**, open the Exchange admin center. If necessary, sign in as **Adatum\Administrator** with the password **Pa55w.rd**.
12. In the **Exchange admin center** window, select **Enterprise** to confirm that you are viewing the on-premises environment, and then in the navigation pane on the left side, select **permissions**.
13. Select the **admin roles** tab.
14. Double-click **Discovery Management**.
15. In the **Role Group** window, ensure that **Beth Burke** is in the **Members** list. Close the **Role Group** window.
16. In the **Exchange admin center** window, select **Office 365** to confirm that you are viewing the online environment, and then in the navigation pane on the left side, select **permissions**.
17. Select the **admin roles** tab.
18. Double-click **Discovery Management**.
19. In the **Role Group** window, in the **Members** list, select **Add** (the plus sign icon).
20. In the **Select Members** window, select both **Beth Burke** accounts, select **add**, select **OK**, and then in the **Role Group** window, select **Save**.

    > **Note:** Beth Burke has two accounts in the list. One is the online account and the other is the account that is synronized with on-premieses. You can select both accounts for this step. Beth now has Organization Management and Discovery Management permissions on-premises and online. This allows Beth to perform criteria-based In-Place Holds and litigation holds. For the permissions to take effect, you need to close and reopen the Exchange admin center.

21. Close the Exchange admin center.
22. Open the Exchange admin center, and then sign in as **Adatum\Beth** with the password **Pa55w.rd**. In the **Language** field, select **English (United States)**, select your time zone, and then select **save**.
23. In the **Exchange admin center** window, select **Enterprise** to verify that you are viewing the on-premises environment, and then in the navigation pane on the left side, select **compliance management**.
24. On the toolbar, select **New**.
25. In the **new in-place eDiscovery &amp; hold** window, in the **Name** box, type **R&amp;D data preservation**, and then select **Next**.
26. On the **mailboxes** page, select **Specify mailboxes to search**, and then select **Add**.
27. In the **Select Mailbox** window, add mailboxes for users **Cai Chu**, **Jon Friday**, **Adam Hobbs**, and then select **OK**.
28. Select **Next**.
29. On the **Search query** page, select **Filter based on criteria**. In the **Keywords** box, type **ProjectX**.
30. Select **select message types**.
31. In the **Message Types to Search** window, select **Select the message types to search**, and then select **Email**.
32. Select **OK**, and then select **Next**.
33. On the **In-Place Hold settings** page, select **Place content matching the search query in selected sources on hold**, select **Specify number of days to hold items relative to their received date**, and then type **720**.
34. Select **Finish**.
35. Select **Close**.
36. Return to Exercise 2, Task 1, Step 23 to complete the mailbox moves.


#### Task 4: Prepare for the next module
  
- When you are finished with the lab, keep all the virtual machines running. You will need them in their current state for the next module.

> **Result**: After completing this exercise, you should have configured the compliance features, message archiving, and DLP.


Â©2019 Microsoft Corporation. All rights reserved.

The text in this document is available under the [Creative Commons Attribution 3.0 License](https://creativecommons.org/licenses/by/3.0/legalcode "Creative Commons Attribution 3.0 License"), additional terms may apply. All other content contained in this document (including, without limitation, trademarks, logos, images, etc.) are **not** included within the Creative Commons license grant. This document does not provide you with any legal rights to any intellectual property in any Microsoft product. You may copy and use this document for your internal, reference purposes.

This document is provided "as-is." Information and views expressed in this document, including URL and other Internet Web site references, may change without notice. You bear the risk of using it. Some examples are for illustration only and are fictitious. No real association is intended or inferred. Microsoft makes no warranties, express or implied, with respect to the information provided here.

  
